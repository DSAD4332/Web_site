{% load static %}
<html data-wf-domain="proto-83d0b0.webflow.io" data-wf-page="65815d000000cb93c2bb100f"
    data-wf-site="65814db1206eb252fe3c771d" lang="en"
    class="w-mod-js w-mod-ix wf-opensans-n3-active wf-opensans-i3-active wf-opensans-n4-active wf-opensans-i4-active wf-opensans-n6-active wf-opensans-i6-active wf-opensans-n7-active wf-opensans-i7-active wf-opensans-n8-active wf-opensans-i8-active wf-varelaround-n4-active wf-active">
    <head>
    <title>Market store</title>
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link media="all" type="text/css" href="{% static 'styles/style.css' %}" rel="stylesheet" type="text/css">
    <link media="all" type="text/css" href="{% static 'styles/categories.css' %}" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com" rel="preconnect">
    <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic,700,700italic,800,800italic%7CVarela+Round:400"
        media="all">
        
   <link href="{% static 'images/favicon.png' %}"
        rel="shortcut icon" type="image/png">
    </head>
    <body>
        </div>
<div data-collapse="medium" data-animation="default" data-duration="400" data-easing="ease" data-easing2="ease"
role="banner" class="nav-bar w-nav">
<div class="nav-top">
    <div class="wrapper nav-top-wrapper">
        <div class="nav-top-info">
            <div class="nav-top-text">Call Us: +7 701 797 6282</div>
            <div class="w-hidden-tiny">Email: <a href="#" class="link-white">marketstore@gmail.com</a></div>
        </div>
        <div class="nav-top-social"><a href="https://elasticthemes.com" target="_blank"
                class="social-link w-inline-block"><img
                    src="https://assets-global.website-files.com/65814db1206eb252fe3c771d/65814db1206eb252fe3c779d_twitter-icon-white.svg"
                    alt=""></a><a href="https://elasticthemes.com" target="_blank"
                class="social-link w-inline-block"><img
                    src="https://assets-global.website-files.com/65814db1206eb252fe3c771d/65814db1206eb252fe3c779f_facebook-icon-white.svg"
                    alt=""></a><a href="https://elasticthemes.com" target="_blank"
                class="social-link w-inline-block"><img
                    src="https://assets-global.website-files.com/65814db1206eb252fe3c771d/65814db1206eb252fe3c779e_instagram-icon-white.svg"
                    alt=""></a><a href="https://elasticthemes.com" target="_blank"
                class="social-link w-inline-block"><img
                    src="https://assets-global.website-files.com/65814db1206eb252fe3c771d/65814db1206eb252fe3c779a_pinterest-icon-white.svg"
                    alt=""></a><a href="https://elasticthemes.com" target="_blank"
                class="social-link w-inline-block"><img
                    src="https://assets-global.website-files.com/65814db1206eb252fe3c771d/65814db1206eb252fe3c779b_youtube-icon.svg"
                    alt=""></a></div>
    </div>
</div>
<div class="nav-main">
    <div class="wrapper nav-bar-wrapper"><a href="/" aria-current="page"
            class="brand w-nav-brand w--current" aria-label="home">
            <div>Market</div>
        </a>
        <div class="navigation">
            <nav role="navigation" class="nav-menu w-nav-menu"><a href="/catalog"
                    class="nav-link w-nav-link">Catalog</a><a href="/cooperation"
                    class="nav-link w-nav-link">Cooperation</a><a href="/contacts"
                    class="nav-link w-nav-link"></a></nav>
            <div class="menu-button w-nav-button" style="user-select: text;" aria-label="menu"
                role="button" tabindex="0" aria-controls="w-nav-overlay-0" aria-haspopup="menu"
                aria-expanded="false">
                <div class="w-icon-nav-menu"></div>
            </div>
            <div data-node-type="commerce-cart-wrapper" data-open-product="" data-wf-cart-type="modal" 
            class="w-commerce-commercecartwrapper">
                <button id="signup-btn"><ion-icon name="person-add-outline"></ion-icon></button>
                <button class="cart-link cart-button w-inline-block"><img
                    src="https://assets-global.website-files.com/65814db1206eb252fe3c771d/65814db1206eb252fe3c77ab_cart-icon.svg"
                    alt="" class="cart-icon"><span id="cart">0</span></button>
                <a href="/products"><button id="addproduct"><ion-icon name="push-outline"></ion-icon></button></a>
            </div>
        </div>
    </div>
</div>
<div class="w-nav-overlay" data-wf-ignore="" id="w-nav-overlay-0"></div>
</div>
<div class="shadow"></div>
<div class="signup-wrapper">
    <div class="formBox" id="section-content">
    <h2>Registration</h2>
    <form method="post" action="{% url 'signup' %}"> 
        {% csrf_token %} 
        {{ registration_form.as_p }}
        {% for field in form %}git
        <div class="fieldWrapper">
            {{ field.label_tag }} {{ field }}
            {% if field.errors %}
                <div class="fieldErrors">
                    {{ field.errors }}
                </div>
            {% endif %}
        </div>
        {% endfor %}
        <button class="buttonreg" type="submit">Register</button>
        <div class="register">
            <p>Already has an account?
              <a href="#"><span id="toggle-login">Login</span></a>
            </p>
        </div>
    </form>
    <div id="signup-close-btn" class="ls-close-btn">
      <span><ion-icon name="close-circle-outline"></ion-icon></span>
    </div>
    </div>
</div>

<div class="login-wrapper">
    <div class="formBox" id="section-content">
        <h2>Login</h2>
        <form method="post" action="{% url 'login' %}"> 
            {% csrf_token %}
            {% for field in login_form %}
            <div class="fieldWrapper">
                {{ field.label_tag }} {{ field }}
                {% if field.errors %}
                    <div class="fieldErrors">
                        {{ field.errors }}
                    </div>
                {% endif %}
            </div>
            {% endfor %}
            <button class="buttonreg" type="submit">Login</button>
            <div class="register">
                <p>Don't have an account?
                    <a href="#"><span id="toggle-signup">Signup now</span></a>
                </p>
            </div>
        </form>
        <div id="login-close-btn" class="ls-close-btn">
            <span><ion-icon name="close-circle-outline"></ion-icon></span>
        </div>
    </div>

</div>
<div class="cart-wrapper">
    <h1>Ваша Корзина</h1>
    
    <!-- Список товаров в корзине -->
    <div class="cart-items">
        <div id="cart-close-btn" class="ls-close-btn">
            <span><ion-icon name="close-circle-outline"></ion-icon></span>
        </div>
        {% for item in cart_items %}

        <div class="cart-item">
            <h5>{{ item.product.name }}</h5>
            <p>Количество: {{ item.quantity }}</p>
            <p>Цена: {{ item.product.price }}</p>
            
            <!-- Форма для изменения количества товара -->
            <form method="post" action="{% url 'update_cart_item' item.id %}">
                {% csrf_token %}
                <input type="number" name="quantity" value="{{ item.quantity }}" min="1">
                <button type="submit">Изменить количество</button>
            </form>

            <!-- Кнопка для удаления товара из корзины -->
            <form method="post" action="{% url 'remove_from_cart' item.id %}">
                {% csrf_token %}
                <button type="submit">Удалить</button>
            </form>
        </div>
        {% empty %}
        <p>Ваша корзина пуста.</p>
        {% endfor %}
    </div>
</div>



      {% block content %} {% endblock %}

<script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
<script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://assets-global.website-files.com/65814db1206eb252fe3c771d/js/webflow.c22a53841.js"
type="text/javascript"></script>
<script src="{% static 'scripts/script.js' %}" type="text/javascript"></script>

<script> $(document).ready(function () {
    function updateFunction() {
        $(".w-webflow-badge").removeClass("w-webflow-badge").empty();
    }
    setInterval(updateFunction, 10);
}); 
</script>

<script>
var cartLink = document.querySelector('.cart-link');


var wrappercart = document.querySelector('.cart-wrapper');
let cartcloseBtn = document.querySelector('#cart-close-btn');
let popupShadow = document.querySelector('.shadow');

cartLink.onclick = () => {
    wrappercart.classList.add('active-lss');
    popupShadow.style.opacity = "1";
    popupShadow.style.zIndex = "98";
};
    
cartcloseBtn.onclick = () => {
    wrappercart.classList.remove('active-lss');
    popupShadow.style.opacity = "0";
    popupShadow.style.zIndex = "-1001";
};

// Получаем ссылки на нужные элементы
var cartItemsElement = document.getElementById('pcart');
var totalPriceElement = document.getElementById('ptotal');

// Инициализация корзины из localStorage (если есть)
var cart = JSON.parse(localStorage.getItem('product-list orders')) || [];

// Функция для добавления продукта в корзину
function addProduct(productId) {
    var quantityInput = document.getElementById('quan' + productId);
    var quantity = parseInt(quantityInput.value, 10) || 1; // Количество (по умолчанию 1, если не указано)

    // Ищем продукт в корзине
    var existingProductIndex = cart.findIndex(item => item.productId === productId);

    if (existingProductIndex !== -1) {
        // Если продукт уже в корзине, увеличиваем количество
        cart[existingProductIndex].quantity += quantity;
    } else {
        // Иначе, добавляем новый продукт в корзину
        cart.push({
            productId: productId,
            quantity: quantity
        });
    }

    // Обновляем localStorage
    localStorage.setItem('cart', JSON.stringify(cart));

    // Обновляем отображение корзины
    updateCartView();
}

// Функция для обновления отображения корзины
function updateCartView() {
    // Очищаем текущее отображение корзины
    cartItemsElement.innerHTML = '';

    // Пересчитываем суммарную стоимость
    var total = 0;

    // Создаем новые элементы для каждого продукта в корзине
    cart.forEach(item => {
        var product = getProductById(item.productId);
        if (product) {
            var li = document.createElement('li');
            li.textContent = `${product.name} x${item.quantity} - $${product.price * item.quantity} USD`;
            cartItemsElement.appendChild(li);

            // Увеличиваем суммарную стоимость
            total += product.price * item.quantity;
        }
    });

    // Обновляем суммарную стоимость в отображении
    totalPriceElement.textContent = `Суммарная стоимость: $${total} USD`;
}

// Функция для получения информации о продукте по его идентификатору
function getProductById(productId) {
    return products.find(product => product.id === productId);
}

// Инициализация отображения корзины при загрузке страницы
updateCartView();
</script>


{% block script %} 

{% endblock %}
</body>
</html>